<!DOCTYPE html>
<html lang="en">
<!-- 
    Microsoft Entra ID Branding Configurator
    Free tool for Microsoft 365 administrators
    
    For search engines:
    - This tool helps M365 admins customize their tenant branding
    - Generates compliant assets for Azure AD / Entra ID
    - Includes PowerShell deployment script using Microsoft Graph
    - No data collection, fully client-side processing
    
    Keywords: Microsoft 365 branding, Entra ID customization, Azure AD branding,
    Office 365 tenant customization, Microsoft Graph PowerShell, M365 admin tools
-->
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">
    <meta name="theme-color" content="#1f2937">
    
    <!-- SEO Meta Tags -->
    <title>Microsoft Entra ID Branding Tool - Free M365 Tenant Customization Generator</title>
    <meta name="description" content="Free enterprise tool for Microsoft 365 administrators to generate Entra ID (Azure AD) branding assets. Create banner logos, sign-in backgrounds, and deploy with PowerShell. Compliant with Microsoft Graph API specifications.">
    <meta name="keywords" content="Microsoft 365 branding, Entra ID customization, Azure AD branding, M365 tenant branding, Microsoft Graph PowerShell, organizational branding, sign-in page customization, Office 365 branding, tenant customization tool, Microsoft 365 admin tools">
    <meta name="author" content="@junior6995">
    <meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1">
    <meta name="googlebot" content="index, follow">
    <meta name="language" content="English">
    <meta name="geo.region" content="US">
    <meta name="geo.placename" content="United States">
    
    <!-- Open Graph / Social Media Meta Tags -->
    <meta property="og:title" content="Microsoft Entra ID Branding Configurator - Free M365 Admin Tool">
    <meta property="og:description" content="Generate compliant branding assets for your Microsoft 365 tenant. Includes PowerShell deployment script using Microsoft Graph API.">
    <meta property="og:type" content="website">
    <meta property="og:image" content="https://raw.githubusercontent.com/junior6995/entra-branding-tool/main/preview.png">
    <meta property="og:image:alt" content="Microsoft Entra ID Branding Tool interface showing logo upload and color selection">
    <meta property="og:site_name" content="Entra ID Branding Tool">
    <meta property="og:locale" content="en_US">
    
    <!-- Twitter Card Meta Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Microsoft Entra ID Branding Tool | M365 Customization">
    <meta name="twitter:description" content="Free tool for Microsoft 365 admins to generate Entra ID branding assets with PowerShell deployment.">
    <meta name="twitter:image" content="https://raw.githubusercontent.com/junior6995/entra-branding-tool/main/preview.png">
    <meta name="twitter:image:alt" content="Entra ID branding tool interface">
    <meta name="twitter:creator" content="@junior6995">
    <meta name="twitter:site" content="@junior6995">
    
    <!-- Additional SEO -->
    <link rel="canonical" href="https://junior6995.github.io/entra-branding-tool/">
    <!-- For international Microsoft 365 admins, tool works globally -->
    <!-- <link rel="alternate" hreflang="x-default" href="https://junior6995.github.io/entra-branding-tool/"> -->
    
    <!-- Favicon and App Icons -->
    <link rel="icon" type="image/png" href="/favicon.png">
    <link rel="apple-touch-icon" href="/apple-touch-icon.png">
    
    <!-- DNS Prefetch for performance -->
    <link rel="dns-prefetch" href="https://cdn.tailwindcss.com">
    <link rel="dns-prefetch" href="https://cdnjs.cloudflare.com">
    
    <!-- Schema.org Structured Data -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebApplication",
        "name": "Microsoft Entra ID Branding Configurator",
        "description": "Enterprise tool for Microsoft 365 administrators to generate and deploy Entra ID branding assets using Microsoft Graph PowerShell SDK",
        "applicationCategory": "BusinessApplication",
        "operatingSystem": "Any",
        "offers": {
            "@type": "Offer",
            "price": "0",
            "priceCurrency": "USD"
        },
        "creator": {
            "@type": "Person",
            "name": "@junior6995",
            "url": "https://github.com/junior6995"
        },
        "keywords": "Microsoft 365, Entra ID, Azure AD, tenant branding, PowerShell, Microsoft Graph",
        "softwareRequirements": "Microsoft 365 Global Administrator access, PowerShell 5.1+",
        "screenshot": "https://raw.githubusercontent.com/junior6995/entra-branding-tool/main/screenshot.png"
    }
    </script>
    
    <!-- Article Schema for Rich Snippets -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "TechArticle",
        "headline": "Microsoft Entra ID Branding Tool - Free M365 Customization",
        "description": "Enterprise tool for Microsoft 365 administrators to generate and deploy custom branding assets using Microsoft Graph PowerShell",
        "keywords": "Microsoft 365, Entra ID, Azure AD, tenant branding, PowerShell, Microsoft Graph",
        "datePublished": "2024-01-01",
        "dateModified": "2024-12-01",
        "author": {
            "@type": "Person",
            "name": "@junior6995",
            "url": "https://github.com/junior6995"
        },
        "publisher": {
            "@type": "Organization",
            "name": "Microsoft 365 Admin Tools",
            "logo": {
                "@type": "ImageObject",
                "url": "https://junior6995.github.io/entra-branding-tool/logo.png"
            }
        },
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https://junior6995.github.io/entra-branding-tool/"
        }
    }
    </script>
    
    <!-- FAQ Schema for SEO -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "FAQPage",
        "mainEntity": [{
            "@type": "Question",
            "name": "What is the Microsoft Entra ID Branding Tool?",
            "acceptedAnswer": {
                "@type": "Answer",
                "text": "It's a free web-based tool for Microsoft 365 administrators to generate compliant branding assets for their tenant. It creates banner logos, headers, favicons, and sign-in backgrounds that meet Microsoft Graph API specifications."
            }
        },{
            "@type": "Question",
            "name": "What permissions are required to deploy Entra ID branding?",
            "acceptedAnswer": {
                "@type": "Answer",
                "text": "You need Global Administrator or Application Administrator role in your Microsoft 365 tenant, plus the Organization.ReadWrite.All scope when using Microsoft Graph PowerShell."
            }
        },{
            "@type": "Question",
            "name": "Is this tool secure for enterprise use?",
            "acceptedAnswer": {
                "@type": "Answer",
                "text": "Yes, all processing happens locally in your browser using client-side JavaScript. No data is transmitted to external servers. The PowerShell script connects directly to Microsoft Graph."
            }
        },{
            "@type": "Question",
            "name": "What image formats does the tool generate?",
            "acceptedAnswer": {
                "@type": "Answer",
                "text": "The tool generates PNG images for logos (banner 280x60px, header 245x36px, square 240x240px, favicon 32x32px) and JPEG for sign-in backgrounds (1920x1080px), all within Microsoft's size limits."
            }
        }]
    }
    </script>
    
    <!-- Breadcrumb Schema -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "BreadcrumbList",
        "itemListElement": [{
            "@type": "ListItem",
            "position": 1,
            "name": "Microsoft 365 Admin Tools",
            "item": "https://junior6995.github.io"
        },{
            "@type": "ListItem",
            "position": 2,
            "name": "Entra ID Branding Tool",
            "item": "https://junior6995.github.io/entra-branding-tool/"
        }]
    }
    </script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- External Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    
    <style>
        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3498db;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            display: inline-block;
            margin-right: 8px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-900">
    <noscript>
        <div class="bg-red-600 text-white p-4 text-center">
            This Microsoft 365 branding tool requires JavaScript to generate Entra ID assets. Please enable JavaScript in your browser.
        </div>
    </noscript>
    
    <!-- Skip to main content for accessibility -->
    <a href="#main-content" class="sr-only focus:not-sr-only focus:absolute focus:top-2 focus:left-2 bg-blue-600 text-white px-4 py-2 rounded">Skip to main content</a>
    <div id="app" class="min-h-screen bg-gray-900">
        <!-- Header -->
        <header class="bg-gray-800 shadow-lg border-b border-gray-700">
            <div class="max-w-7xl mx-auto px-8 py-6">
                <h1 class="text-3xl font-bold text-gray-100 mb-3">Microsoft Entra ID Branding Configurator</h1>
                <h2 class="sr-only">Free Microsoft 365 Tenant Branding Tool for Azure AD Customization</h2>
                <div class="text-gray-300 space-y-2">
                    <p class="text-lg">🎨 <strong>Enterprise-grade branding asset generator</strong> for Microsoft 365 tenant customization</p>
                    <nav class="grid grid-cols-2 gap-4 mt-4 text-sm">
                        <div class="flex items-start">
                            <span class="text-green-400 mr-2" aria-hidden="true">✓</span>
                            <span>Compliant with <a href="https://learn.microsoft.com/en-us/entra/fundamentals/how-to-customize-branding" target="_blank" rel="noopener noreferrer" class="text-blue-400 underline hover:text-blue-300" title="Microsoft official documentation for Entra ID branding">Microsoft Graph API specifications</a></span>
                        </div>
                        <div class="flex items-start">
                            <span class="text-green-400 mr-2" aria-hidden="true">✓</span>
                            <span>Automated deployment via Microsoft.Graph PowerShell SDK</span>
                        </div>
                    </nav>
                    
                    <!-- Security Notice -->
                    <section class="mt-4 p-4 bg-green-900/20 border border-green-700/50 rounded-lg" aria-label="Security Information">
                        <h2 class="font-semibold text-green-400 mb-2 flex items-center">
                            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"></path>
                            </svg>
                            Zero-Trust Architecture
                        </h2>
                        <ul class="text-sm text-gray-300 space-y-1 ml-7">
                            <li>• Client-side Canvas API processing only</li>
                            <li>• No external API calls or data transmission</li>
                            <li>• Direct tenant connection via Microsoft Graph PowerShell</li>
                            <li>• Requires Organization.ReadWrite.All scope for deployment</li>
                        </ul>
                    </section>
                    
                    <!-- Demo Tenant Warning -->
                    <aside class="mt-4 p-4 bg-yellow-900/20 border border-yellow-700/50 rounded-lg" role="alert">
                        <h2 class="font-semibold text-yellow-400 mb-2 flex items-center">
                            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
                            </svg>
                            Production Deployment Notice for Microsoft 365 Administrators
                        </h2>
                        <p class="text-sm text-gray-300 ml-7">
                            <strong>Recommendation:</strong> Test all branding assets in a Microsoft 365 Developer Program tenant before deploying to production. Changes can take up to 24 hours to propagate and affect all users globally.
                        </p>
                    </aside>
                    
                    <!-- Technical Details -->
                    <details class="mt-4 bg-gray-800 border border-gray-700 rounded-lg p-4">
                        <summary class="cursor-pointer font-semibold text-gray-200 hover:text-gray-100">📋 Technical Implementation Details for Azure AD / Entra ID Branding</summary>
                        <div class="mt-3 space-y-3 text-sm text-gray-300">
                            <section>
                                <h3 class="font-semibold">Asset Generation Pipeline:</h3>
                                <ul class="ml-6 mt-1 list-disc space-y-1">
                                    <li>HTML5 Canvas 2D Context with high-quality image smoothing enabled</li>
                                    <li>Dynamic compression algorithms optimized for each file type</li>
                                    <li>Banner logo: No compression (1.0) to maximize quality within 50KB</li>
                                    <li>Header logo: Moderate compression (0.7) for 10KB limit</li>
                                    <li>Square logos: No compression (1.0) to maximize quality within 50KB</li>
                                    <li>Favicon: High quality (0.9) within 5KB limit</li>
                                    <li>JPEG background: Maximum quality (0.98) within 300KB limit</li>
                                </ul>
                            </section>
                            <section>
                                <h3 class="font-semibold">Microsoft Graph API Endpoints:</h3>
                                <ul class="ml-6 mt-1 list-disc space-y-1 font-mono text-xs">
                                    <li>Set-MgOrganizationBrandingLocalizationBannerLogo</li>
                                    <li>Set-MgOrganizationBrandingLocalizationHeaderLogo</li>
                                    <li>Set-MgOrganizationBrandingLocalizationSquareLogo</li>
                                    <li>Set-MgOrganizationBrandingLocalizationFavicon</li>
                                    <li>Set-MgOrganizationBrandingLocalizationBackgroundImage</li>
                                </ul>
                            </section>
                            <section>
                                <h3 class="font-semibold">Localization Strategy for Office 365 Branding:</h3>
                                <ul class="ml-6 mt-1 list-disc space-y-1">
                                    <li>Default localization (id: "0") for light theme assets</li>
                                    <li>en-US localization for dark theme configuration</li>
                                    <li>Only square logo has a dark-specific variant</li>
                                    <li>All other assets (banner, header, favicon, background) shared between themes</li>
                                    <li>Background color property synchronized across localizations</li>
                                </ul>
                            </section>
                        </div>
                    </details>
                </div>
            </div>
        </header>

        <main class="max-w-7xl mx-auto px-8 py-8" id="main-content">
            <!-- Main Content -->
            <div class="grid grid-cols-2 gap-8">
                <!-- Configuration Panel -->
                <section class="bg-gray-800 rounded-lg shadow-xl p-6 border border-gray-700" aria-label="Branding Configuration">
                    <h2 class="text-xl font-semibold mb-6 text-gray-100">Microsoft 365 Branding Configuration</h2>
                    
                    <!-- Primary Color -->
                    <div class="mb-6">
                        <label for="primaryColor" class="block text-sm font-medium text-gray-300 mb-2">
                            Primary Brand Color for Office 365
                        </label>
                        <div class="flex items-center space-x-4">
                            <input type="color" id="primaryColor" value="#0078D4" class="h-12 w-24 rounded cursor-pointer" aria-label="Primary color picker" title="Choose primary brand color for Microsoft 365">
                            <input type="text" id="primaryColorText" value="#0078D4" class="flex-1 px-3 py-2 bg-gray-700 border border-gray-600 text-gray-100 rounded-md font-mono" aria-label="Primary color hex value" title="Enter hex color code" placeholder="#0078D4">
                        </div>
                    </div>
                    
                    <!-- Secondary Color -->
                    <div class="mb-6">
                        <label for="secondaryColor" class="block text-sm font-medium text-gray-300 mb-2">
                            Secondary Color for Azure AD Branding
                        </label>
                        <div class="flex items-center space-x-4">
                            <input type="color" id="secondaryColor" value="#106EBE" class="h-12 w-24 rounded cursor-pointer" aria-label="Secondary color picker" title="Choose secondary brand color for Azure AD">
                            <input type="text" id="secondaryColorText" value="#106EBE" class="flex-1 px-3 py-2 bg-gray-700 border border-gray-600 text-gray-100 rounded-md font-mono" aria-label="Secondary color hex value" title="Enter hex color code" placeholder="#106EBE">
                        </div>
                    </div>
                    
                    <!-- Logo Upload -->
                    <div class="mb-6">
                        <label for="uploadBtn" class="block text-sm font-medium text-gray-300 mb-2">
                            Company Logo for Microsoft 365 Tenant (PNG with transparent background)
                        </label>
                        <input type="file" id="logoInput" accept="image/*" class="hidden" aria-label="Logo file input">
                        <button id="uploadBtn" class="w-full px-4 py-3 border-2 border-dashed border-gray-600 rounded-lg hover:border-gray-500 transition-colors" aria-label="Upload company logo">
                            <span id="uploadText" class="text-gray-400">Click to upload logo</span>
                            <div id="logoPreview" class="hidden flex items-center justify-center">
                                <img id="logoImg" class="h-16 mr-4" alt="Uploaded company logo preview" rel="ugc">
                                <span class="text-green-400">✓ Logo uploaded</span>
                            </div>
                        </button>
                    </div>
                    
                    <!-- Generate Button -->
                    <button id="generateBtn" disabled class="w-full px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-gray-700 disabled:text-gray-500 disabled:cursor-not-allowed transition-colors font-semibold" aria-label="Generate Microsoft 365 branding package">
                        <span id="generateText">Generate Branding Package</span>
                        <div id="generateSpinner" class="hidden">
                            <div class="spinner" aria-hidden="true"></div>
                            Generating Microsoft 365 Assets...
                        </div>
                    </button>
                    
                    <!-- Info Box -->
                    <aside class="mt-6 p-4 bg-blue-900/30 border border-blue-700/50 rounded-lg" aria-label="Microsoft branding specifications">
                        <h3 class="font-semibold text-sm text-blue-300 mb-2">Image Specifications (Microsoft Graph API):</h3>
                        <ul class="text-xs text-blue-200 space-y-1">
                            <li>• <strong>Sign-in background:</strong> 1920×1080px, JPEG, max 300KB (shared asset)</li>
                            <li>• <strong>Banner logo:</strong> 280×60px, PNG, max 50KB (shared asset)</li>
                            <li>• <strong>Header logo:</strong> 245×36px, PNG, max 10KB (shared asset)</li>
                            <li>• <strong>Square logos:</strong> 240×240px, PNG, max 50KB (light/dark variants)</li>
                            <li>• <strong>Favicon:</strong> 32×32px, PNG, max 5KB (shared asset)</li>
                        </ul>
                    </aside>
                </section>
                
                <!-- Preview Panel -->
                <section class="bg-gray-800 rounded-lg shadow-xl p-6 border border-gray-700" aria-label="Branding preview">
                    <div class="flex items-center justify-between mb-4">
                        <h2 class="text-xl font-semibold text-gray-100">Microsoft 365 Sign-in Page Preview</h2>
                        <button id="darkModeBtn" class="px-3 py-1 rounded-lg bg-gray-700 hover:bg-gray-600 text-sm font-medium text-gray-100" aria-label="Toggle theme preview">
                            <span id="darkModeText">Light Theme</span>
                        </button>
                    </div>
                    
                    <div id="previewArea" class="bg-gray-700 rounded-lg p-4 min-h-[500px] flex items-center justify-center" aria-label="Preview area">
                        <div class="text-center text-gray-400">
                            <p>Upload your company logo to preview Microsoft 365 branding</p>
                            <p class="text-xs mt-2">See how your Entra ID customization will look</p>
                        </div>
                    </div>
                </section>
            </div>
            
            <!-- Results Section -->
            <section id="resultsSection" class="hidden mt-8" aria-label="Download branding package">
                <div class="bg-gray-800 rounded-lg shadow-xl p-8 text-center border border-gray-700">
                    <h2 class="text-2xl font-bold text-gray-100 mb-4">✅ Your Microsoft 365 Branding Package is Ready!</h2>
                    <p class="text-gray-300 mb-6">Download the ZIP file containing all Entra ID branding images and PowerShell deployment script</p>
                    
                    <div class="grid grid-cols-3 gap-4 mb-8 max-w-3xl mx-auto">
                        <div class="bg-green-900/30 border border-green-700/50 p-4 rounded-lg">
                            <h3 class="font-semibold text-green-400">6 Images</h3>
                            <p class="text-sm text-green-300">Entra ID compliant assets</p>
                        </div>
                        <div class="bg-blue-900/30 border border-blue-700/50 p-4 rounded-lg">
                            <h3 class="font-semibold text-blue-400">PowerShell Script</h3>
                            <p class="text-sm text-blue-300">Microsoft Graph deployment</p>
                        </div>
                        <div class="bg-purple-900/30 border border-purple-700/50 p-4 rounded-lg">
                            <h3 class="font-semibold text-purple-400">Auto-Deploy</h3>
                            <p class="text-sm text-purple-300">Global Admin ready</p>
                        </div>
                    </div>
                    
                    <button id="downloadBtn" class="px-8 py-4 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors font-semibold text-lg" aria-label="Download Microsoft 365 branding package">
                        ⬇️ Download Branding Package
                    </button>
                    
                    <div class="mt-8 text-left max-w-2xl mx-auto">
                        <h3 class="font-semibold mb-3 text-gray-100">Quick Deployment Steps for Microsoft 365 Administrators:</h3>
                        <ol class="text-sm text-gray-300 space-y-2">
                            <li>1. Extract the ZIP file to a folder</li>
                            <li>2. Open PowerShell as Administrator</li>
                            <li>3. Navigate to the extracted folder</li>
                            <li>4. Run: <code class="bg-gray-700 px-2 py-1 rounded text-gray-100" lang="powershell">.\Deploy-M365Branding.ps1</code></li>
                        </ol>
                    </div>
                </div>
            </section>
        </main>
        
        <!-- Footer -->
        <footer class="mt-16 py-8 text-center text-gray-400">
            <p class="text-sm">
                Microsoft Entra ID Branding Tool created by <a href="https://github.com/junior6995/" target="_blank" rel="noopener noreferrer" class="text-blue-400 hover:text-blue-300 font-semibold" title="GitHub profile of tool creator">@junior6995</a>
            </p>
            <p class="text-xs mt-2">
                Free tool for Microsoft 365 administrators | Azure AD branding | Office 365 customization | Entra ID tenant branding
            </p>
            <!-- Sitemap: https://junior6995.github.io/sitemap.xml -->
        </footer>
    </div>
    
    <!-- Hidden Canvas for image generation -->
    <canvas id="canvas" style="display: none;" aria-hidden="true"></canvas>
    
    <script>
        // Global variables
        let logo = null;
        let logoDataUrl = null;
        let darkMode = false;
        let generatedAssets = {};
        
        // Get elements
        const primaryColorInput = document.getElementById('primaryColor');
        const primaryColorText = document.getElementById('primaryColorText');
        const secondaryColorInput = document.getElementById('secondaryColor');
        const secondaryColorText = document.getElementById('secondaryColorText');
        const logoInput = document.getElementById('logoInput');
        const uploadBtn = document.getElementById('uploadBtn');
        const uploadText = document.getElementById('uploadText');
        const logoPreview = document.getElementById('logoPreview');
        const logoImg = document.getElementById('logoImg');
        const generateBtn = document.getElementById('generateBtn');
        const generateText = document.getElementById('generateText');
        const generateSpinner = document.getElementById('generateSpinner');
        const darkModeBtn = document.getElementById('darkModeBtn');
        const darkModeText = document.getElementById('darkModeText');
        const previewArea = document.getElementById('previewArea');
        const resultsSection = document.getElementById('resultsSection');
        const downloadBtn = document.getElementById('downloadBtn');
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        
        // Set high quality rendering
        ctx.imageSmoothingEnabled = true;
        ctx.imageSmoothingQuality = 'high';
        
        // Color sync
        primaryColorInput.addEventListener('change', (e) => {
            primaryColorText.value = e.target.value;
        });
        primaryColorText.addEventListener('change', (e) => {
            if (/^#[0-9A-F]{6}$/i.test(e.target.value)) {
                primaryColorInput.value = e.target.value;
            }
        });
        secondaryColorInput.addEventListener('change', (e) => {
            secondaryColorText.value = e.target.value;
        });
        secondaryColorText.addEventListener('change', (e) => {
            if (/^#[0-9A-F]{6}$/i.test(e.target.value)) {
                secondaryColorInput.value = e.target.value;
            }
        });
        
        // Logo upload
        uploadBtn.addEventListener('click', () => {
            logoInput.click();
        });
        
        logoInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (event) => {
                    const img = new Image();
                    img.onload = () => {
                        logo = img;
                        logoDataUrl = event.target.result;
                        logoImg.src = logoDataUrl;
                        uploadText.classList.add('hidden');
                        logoPreview.classList.remove('hidden');
                        generateBtn.disabled = false;
                    };
                    img.src = event.target.result;
                };
                reader.readAsDataURL(file);
            }
        });
        
        // Dark mode toggle
        darkModeBtn.addEventListener('click', () => {
            darkMode = !darkMode;
            darkModeText.textContent = darkMode ? 'Dark Theme' : 'Light Theme';
            updatePreview();
        });
        
        // Generate assets
        generateBtn.addEventListener('click', generateAssets);
        
        // Generate banner logo (280x60) - Max 50KB with transparent logo
        function generateBannerLogo() {
            canvas.width = 280;
            canvas.height = 60;
            
            // Use maximum quality settings
            ctx.imageSmoothingEnabled = true;
            ctx.imageSmoothingQuality = 'high';
            
            ctx.clearRect(0, 0, 280, 60);
            
            // Dynamic gradient background with high quality
            const gradient = ctx.createLinearGradient(0, 0, 280, 0);
            gradient.addColorStop(0, adjustColor(primaryColorInput.value, 20));
            gradient.addColorStop(0.25, adjustColor(primaryColorInput.value, 10));
            gradient.addColorStop(0.5, primaryColorInput.value);
            gradient.addColorStop(0.75, secondaryColorInput.value);
            gradient.addColorStop(1, adjustColor(secondaryColorInput.value, -20));
            
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, 280, 60);
            
            // Multiple sophisticated overlay patterns for quality
            ctx.globalAlpha = 0.2;
            
            // Gradient mesh overlay
            for (let i = 0; i < 5; i++) {
                const x = (280 / 5) * i + 28;
                const meshGradient = ctx.createRadialGradient(x, 30, 0, x, 30, 40);
                meshGradient.addColorStop(0, i % 2 === 0 ? '#ffffff' : primaryColorInput.value);
                meshGradient.addColorStop(1, 'transparent');
                ctx.fillStyle = meshGradient;
                ctx.fillRect(0, 0, 280, 60);
            }
            
            ctx.globalAlpha = 0.15;
            
            // Wave pattern with more detail
            ctx.beginPath();
            ctx.moveTo(0, 30);
            for (let i = 0; i <= 280; i += 2) {
                ctx.lineTo(i, 30 + Math.sin(i * 0.02) * 20 + Math.cos(i * 0.01) * 10);
            }
            ctx.lineTo(280, 60);
            ctx.lineTo(0, 60);
            ctx.closePath();
            const waveGradient = ctx.createLinearGradient(0, 0, 0, 60);
            waveGradient.addColorStop(0, 'rgba(255, 255, 255, 0.4)');
            waveGradient.addColorStop(0.5, 'rgba(255, 255, 255, 0.1)');
            waveGradient.addColorStop(1, 'rgba(0, 0, 0, 0.2)');
            ctx.fillStyle = waveGradient;
            ctx.fill();
            
            // High-detail geometric accents
            ctx.globalAlpha = 0.1;
            ctx.strokeStyle = '#ffffff';
            ctx.lineWidth = 1;
            
            // Diagonal lines
            for (let i = -60; i < 340; i += 20) {
                ctx.beginPath();
                ctx.moveTo(i, 0);
                ctx.lineTo(i + 60, 60);
                ctx.stroke();
            }
            
            // Dots pattern for texture
            for (let x = 10; x < 280; x += 15) {
                for (let y = 10; y < 60; y += 15) {
                    ctx.beginPath();
                    ctx.arc(x, y, 1, 0, Math.PI * 2);
                    ctx.fillStyle = 'rgba(255, 255, 255, 0.3)';
                    ctx.fill();
                }
            }
            
            ctx.globalAlpha = 1;
            
            if (logo) {
                // Center the logo with optimal sizing
                const logoAspect = logo.width / logo.height;
                let drawWidth, drawHeight;
                const maxHeight = 50;
                const maxWidth = 200;
                
                if (logoAspect > maxWidth/maxHeight) {
                    drawWidth = maxWidth;
                    drawHeight = drawWidth / logoAspect;
                } else {
                    drawHeight = maxHeight;
                    drawWidth = drawHeight * logoAspect;
                }
                
                const x = (280 - drawWidth) / 2;
                const y = (60 - drawHeight) / 2;
                
                // High quality shadow
                ctx.shadowColor = 'rgba(0, 0, 0, 0.3)';
                ctx.shadowBlur = 5;
                ctx.shadowOffsetX = 2;
                ctx.shadowOffsetY = 2;
                
                // Draw logo with maximum quality
                ctx.drawImage(logo, x, y, drawWidth, drawHeight);
                ctx.shadowColor = 'transparent';
            } else {
                // Fallback: show initial
                ctx.fillStyle = '#ffffff';
                ctx.font = 'bold 32px -apple-system, BlinkMacSystemFont, "Segoe UI", Arial';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.shadowColor = 'rgba(0,0,0,0.3)';
                ctx.shadowBlur = 4;
                ctx.fillText('C', 140, 30);
            }
            
            // Return with NO compression to maximize quality within 50KB
            return canvas.toDataURL('image/png', 1.0);
        }
        
        // Generate header logo (245x36) - Max 10KB with creative design
        function generateHeaderLogo() {
            canvas.width = 245;
            canvas.height = 36;
            
            // Use maximum quality settings
            ctx.imageSmoothingEnabled = true;
            ctx.imageSmoothingQuality = 'high';
            
            // Clear with transparency
            ctx.clearRect(0, 0, 245, 36);
            
            if (logo) {
                // Creative gradient background strip with more detail
                const bgGradient = ctx.createLinearGradient(0, 0, 245, 0);
                bgGradient.addColorStop(0, primaryColorInput.value + '20');
                bgGradient.addColorStop(0.3, secondaryColorInput.value + '15');
                bgGradient.addColorStop(0.7, primaryColorInput.value + '15');
                bgGradient.addColorStop(1, secondaryColorInput.value + '20');
                ctx.fillStyle = bgGradient;
                ctx.fillRect(0, 0, 245, 36);
                
                // Multiple accent lines for quality
                const accentGradient = ctx.createLinearGradient(0, 0, 245, 0);
                accentGradient.addColorStop(0, primaryColorInput.value);
                accentGradient.addColorStop(0.25, adjustColor(primaryColorInput.value, 20));
                accentGradient.addColorStop(0.5, secondaryColorInput.value);
                accentGradient.addColorStop(0.75, adjustColor(secondaryColorInput.value, 20));
                accentGradient.addColorStop(1, primaryColorInput.value);
                ctx.fillStyle = accentGradient;
                ctx.fillRect(0, 34, 245, 2);
                
                // Additional top accent
                ctx.globalAlpha = 0.5;
                ctx.fillRect(0, 0, 245, 1);
                ctx.globalAlpha = 1;
                
                // Logo positioning - left side
                const logoAspect = logo.width / logo.height;
                let drawWidth, drawHeight;
                const maxHeight = 28;
                const maxWidth = 80;
                
                if (logoAspect > maxWidth/maxHeight) {
                    drawWidth = maxWidth;
                    drawHeight = drawWidth / logoAspect;
                } else {
                    drawHeight = maxHeight;
                    drawWidth = drawHeight * logoAspect;
                }
                
                const x = 8;
                const y = (36 - drawHeight) / 2;
                
                // Enhanced white backing for logo visibility
                const backingGradient = ctx.createRadialGradient(x + drawWidth/2, y + drawHeight/2, 0, x + drawWidth/2, y + drawHeight/2, drawWidth/2);
                backingGradient.addColorStop(0, 'rgba(255, 255, 255, 0.9)');
                backingGradient.addColorStop(1, 'rgba(255, 255, 255, 0.7)');
                ctx.fillStyle = backingGradient;
                ctx.fillRect(x - 3, y - 3, drawWidth + 6, drawHeight + 6);
                
                // High quality shadow
                ctx.shadowColor = 'rgba(0, 0, 0, 0.2)';
                ctx.shadowBlur = 3;
                ctx.shadowOffsetX = 1;
                ctx.shadowOffsetY = 1;
                
                ctx.drawImage(logo, x, y, drawWidth, drawHeight);
                ctx.shadowColor = 'transparent';
                
                // Enhanced geometric elements on right
                ctx.globalAlpha = 0.3;
                
                // Multiple triangles for depth
                for (let i = 0; i < 3; i++) {
                    ctx.fillStyle = i % 2 === 0 ? secondaryColorInput.value : primaryColorInput.value;
                    ctx.beginPath();
                    ctx.moveTo(245 - (i * 15), 0);
                    ctx.lineTo(200 - (i * 15), 0);
                    ctx.lineTo(245 - (i * 15), 36);
                    ctx.closePath();
                    ctx.fill();
                    ctx.globalAlpha *= 0.7;
                }
                ctx.globalAlpha = 1;
                
            } else {
                // Fallback design with enhanced gradient
                const gradient = ctx.createLinearGradient(0, 0, 245, 0);
                gradient.addColorStop(0, primaryColorInput.value);
                gradient.addColorStop(0.5, secondaryColorInput.value);
                gradient.addColorStop(1, primaryColorInput.value);
                ctx.fillStyle = gradient;
                ctx.fillRect(0, 0, 245, 36);
                
                ctx.fillStyle = '#ffffff';
                ctx.font = 'bold 18px -apple-system, BlinkMacSystemFont, "Segoe UI", Arial';
                ctx.textAlign = 'left';
                ctx.textBaseline = 'middle';
                ctx.fillText('Your Company', 10, 18);
            }
            
            // Return with optimized compression for 10KB limit
            return canvas.toDataURL('image/png', 0.7);
        }
        
        // Generate favicon (32x32) - Max 5KB
        function generateFavicon() {
            canvas.width = 32;
            canvas.height = 32;
            
            // Maximum quality for small image
            ctx.imageSmoothingEnabled = true;
            ctx.imageSmoothingQuality = 'high';
            
            ctx.clearRect(0, 0, 32, 32);
            
            if (logo) {
                // White background for visibility
                ctx.fillStyle = '#ffffff';
                ctx.fillRect(0, 0, 32, 32);
                
                // Enhanced brand accent with gradient
                const accentGradient = ctx.createRadialGradient(16, 16, 0, 16, 16, 22);
                accentGradient.addColorStop(0, primaryColorInput.value + '30');
                accentGradient.addColorStop(0.5, secondaryColorInput.value + '20');
                accentGradient.addColorStop(1, primaryColorInput.value + '10');
                ctx.fillStyle = accentGradient;
                ctx.fillRect(0, 0, 32, 32);
                
                // Add subtle border for definition
                ctx.strokeStyle = primaryColorInput.value + '40';
                ctx.lineWidth = 1;
                ctx.strokeRect(0.5, 0.5, 31, 31);
                
                const logoAspect = logo.width / logo.height;
                let drawWidth, drawHeight;
                const maxSize = 26; // Slightly smaller for padding
                
                if (logoAspect > 1) {
                    drawWidth = maxSize;
                    drawHeight = maxSize / logoAspect;
                } else {
                    drawHeight = maxSize;
                    drawWidth = maxSize * logoAspect;
                }
                
                const x = (32 - drawWidth) / 2;
                const y = (32 - drawHeight) / 2;
                
                // Subtle shadow for depth
                ctx.shadowColor = 'rgba(0, 0, 0, 0.2)';
                ctx.shadowBlur = 2;
                ctx.shadowOffsetX = 1;
                ctx.shadowOffsetY = 1;
                
                ctx.drawImage(logo, x, y, drawWidth, drawHeight);
                ctx.shadowColor = 'transparent';
            } else {
                // Enhanced gradient background with initial
                const gradient = ctx.createRadialGradient(16, 16, 0, 16, 16, 16);
                gradient.addColorStop(0, adjustColor(primaryColorInput.value, 20));
                gradient.addColorStop(0.5, primaryColorInput.value);
                gradient.addColorStop(1, secondaryColorInput.value);
                ctx.fillStyle = gradient;
                ctx.fillRect(0, 0, 32, 32);
                
                // Add inner border
                ctx.strokeStyle = 'rgba(255, 255, 255, 0.3)';
                ctx.lineWidth = 1;
                ctx.strokeRect(1.5, 1.5, 29, 29);
                
                ctx.fillStyle = '#ffffff';
                ctx.font = 'bold 20px -apple-system, BlinkMacSystemFont, "Segoe UI", Arial';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.shadowColor = 'rgba(0, 0, 0, 0.3)';
                ctx.shadowBlur = 2;
                ctx.fillText('C', 16, 16);
                ctx.shadowColor = 'transparent';
            }
            
            // Return with high quality to maximize within 5KB
            return canvas.toDataURL('image/png', 0.9);
        }
        
        // Generate square logo (240x240) - Max 50KB simple design
        function generateSquareLogo(theme) {
            canvas.width = 240;
            canvas.height = 240;
            
            // Maximum quality settings
            ctx.imageSmoothingEnabled = true;
            ctx.imageSmoothingQuality = 'high';
            
            // Clear with transparency
            ctx.clearRect(0, 0, 240, 240);
            
            if (logo) {
                // Simple solid background
                if (theme === 'light') {
                    ctx.fillStyle = '#ffffff';
                } else {
                    ctx.fillStyle = '#1a1a1a';
                }
                ctx.fillRect(0, 0, 240, 240);
                
                // Draw logo centered
                const logoAspect = logo.width / logo.height;
                let drawWidth, drawHeight;
                const maxSize = 200;
                
                if (logoAspect > 1) {
                    drawWidth = maxSize;
                    drawHeight = maxSize / logoAspect;
                } else {
                    drawHeight = maxSize;
                    drawWidth = maxSize * logoAspect;
                }
                
                const x = (240 - drawWidth) / 2;
                const y = (240 - drawHeight) / 2;
                
                // Enhanced shadow for depth
                if (theme === 'light') {
                    ctx.shadowColor = 'rgba(0,0,0,0.15)';
                    ctx.shadowBlur = 12;
                    ctx.shadowOffsetX = 2;
                    ctx.shadowOffsetY = 3;
                } else {
                    ctx.shadowColor = 'rgba(0,0,0,0.6)';
                    ctx.shadowBlur = 16;
                    ctx.shadowOffsetX = 3;
                    ctx.shadowOffsetY = 5;
                }
                
                ctx.drawImage(logo, x, y, drawWidth, drawHeight);
                ctx.shadowColor = 'transparent';
                
            } else {
                // No logo - simple gradient square
                const gradient = ctx.createLinearGradient(0, 0, 240, 240);
                if (theme === 'light') {
                    gradient.addColorStop(0, primaryColorInput.value);
                    gradient.addColorStop(1, secondaryColorInput.value);
                } else {
                    gradient.addColorStop(0, adjustColor(primaryColorInput.value, -60));
                    gradient.addColorStop(1, adjustColor(secondaryColorInput.value, -60));
                }
                ctx.fillStyle = gradient;
                ctx.fillRect(0, 0, 240, 240);
                
                // Company initial
                ctx.fillStyle = '#ffffff';
                ctx.font = 'bold 96px -apple-system, BlinkMacSystemFont, "Segoe UI", Arial';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.shadowColor = 'rgba(0,0,0,0.3)';
                ctx.shadowBlur = 4;
                ctx.fillText('C', 120, 120);
                ctx.shadowColor = 'transparent';
            }
            
            // Return with maximum quality for 50KB limit
            return canvas.toDataURL('image/png', 1.0);
        }
        
        // Generate sign-in background (1920x1080) - Max 300KB with distinct themes
        function generateSignInBackground(theme) {
            canvas.width = 1920;
            canvas.height = 1080;
            
            // Maximum quality settings
            ctx.imageSmoothingEnabled = true;
            ctx.imageSmoothingQuality = 'high';
            
            ctx.clearRect(0, 0, 1920, 1080);
            
            if (theme === 'light') {
                // Light theme: Bright and airy
                // Base: White to light brand colors
                const baseGradient = ctx.createLinearGradient(0, 0, 1920, 1080);
                baseGradient.addColorStop(0, '#ffffff');
                baseGradient.addColorStop(0.3, '#f8f9fa');
                baseGradient.addColorStop(0.7, adjustColor(primaryColorInput.value, 170));
                baseGradient.addColorStop(1, adjustColor(primaryColorInput.value, 150));
                ctx.fillStyle = baseGradient;
                ctx.fillRect(0, 0, 1920, 1080);
                
                // Soft color washes
                ctx.globalAlpha = 0.2;
                const wash1 = ctx.createRadialGradient(500, 300, 0, 500, 300, 600);
                wash1.addColorStop(0, primaryColorInput.value);
                wash1.addColorStop(1, 'transparent');
                ctx.fillStyle = wash1;
                ctx.fillRect(0, 0, 1920, 1080);
                
                const wash2 = ctx.createRadialGradient(1400, 700, 0, 1400, 700, 500);
                wash2.addColorStop(0, secondaryColorInput.value);
                wash2.addColorStop(1, 'transparent');
                ctx.fillStyle = wash2;
                ctx.fillRect(0, 0, 1920, 1080);
                
                // Abstract shapes
                ctx.globalAlpha = 0.1;
                ctx.fillStyle = primaryColorInput.value;
                ctx.beginPath();
                ctx.arc(1700, 200, 300, 0, Math.PI * 2);
                ctx.fill();
                
                ctx.beginPath();
                ctx.arc(200, 900, 400, 0, Math.PI * 2);
                ctx.fill();
                
                // Flowing wave
                ctx.globalAlpha = 0.15;
                ctx.beginPath();
                ctx.moveTo(0, 800);
                for (let i = 0; i <= 1920; i += 20) {
                    ctx.lineTo(i, 800 + Math.sin(i * 0.005) * 100);
                }
                ctx.lineTo(1920, 1080);
                ctx.lineTo(0, 1080);
                ctx.closePath();
                ctx.fillStyle = adjustColor(secondaryColorInput.value, 120);
                ctx.fill();
                
            } else {
                // Dark theme: Deep and sophisticated
                // Base: Dark gradient
                const baseGradient = ctx.createLinearGradient(0, 0, 1920, 1080);
                baseGradient.addColorStop(0, '#0a0a0a');
                baseGradient.addColorStop(0.3, '#121212');
                baseGradient.addColorStop(0.7, adjustColor(primaryColorInput.value, -120));
                baseGradient.addColorStop(1, adjustColor(primaryColorInput.value, -100));
                ctx.fillStyle = baseGradient;
                ctx.fillRect(0, 0, 1920, 1080);
                
                // Color accents with glow
                ctx.globalAlpha = 0.3;
                
                // Neon-like glow effect
                const glow1 = ctx.createRadialGradient(300, 300, 0, 300, 300, 500);
                glow1.addColorStop(0, primaryColorInput.value);
                glow1.addColorStop(0.5, adjustColor(primaryColorInput.value, -40));
                glow1.addColorStop(1, 'transparent');
                ctx.fillStyle = glow1;
                ctx.fillRect(0, 0, 1920, 1080);
                
                const glow2 = ctx.createRadialGradient(1600, 800, 0, 1600, 800, 600);
                glow2.addColorStop(0, secondaryColorInput.value);
                glow2.addColorStop(0.5, adjustColor(secondaryColorInput.value, -40));
                glow2.addColorStop(1, 'transparent');
                ctx.fillStyle = glow2;
                ctx.fillRect(0, 0, 1920, 1080);
                
                // Grid pattern
                ctx.globalAlpha = 0.05;
                ctx.strokeStyle = '#ffffff';
                ctx.lineWidth = 1;
                for (let x = 0; x < 1920; x += 80) {
                    ctx.beginPath();
                    ctx.moveTo(x, 0);
                    ctx.lineTo(x, 1080);
                    ctx.stroke();
                }
                for (let y = 0; y < 1080; y += 80) {
                    ctx.beginPath();
                    ctx.moveTo(0, y);
                    ctx.lineTo(1920, y);
                    ctx.stroke();
                }
                
                // Gradient mesh overlay
                ctx.globalAlpha = 0.15;
                const meshGradient = ctx.createLinearGradient(0, 0, 1920, 0);
                meshGradient.addColorStop(0, 'transparent');
                meshGradient.addColorStop(0.5, primaryColorInput.value);
                meshGradient.addColorStop(1, 'transparent');
                ctx.fillStyle = meshGradient;
                ctx.fillRect(0, 400, 1920, 280);
            }
            
            ctx.globalAlpha = 1;
            
            // Return as JPEG with maximum quality within 300KB limit
            return canvas.toDataURL('image/jpeg', 0.98);
        }
        
        function adjustColor(hex, amount) {
            const num = parseInt(hex.replace('#', ''), 16);
            const r = Math.max(0, Math.min(255, ((num >> 16) & 255) + amount));
            const g = Math.max(0, Math.min(255, ((num >> 8) & 255) + amount));
            const b = Math.max(0, Math.min(255, (num & 255) + amount));
            return '#' + ((r << 16) | (g << 8) | b).toString(16).padStart(6, '0');
        }
        
        function generateAssets() {
            generateText.classList.add('hidden');
            generateSpinner.classList.remove('hidden');
            generateBtn.disabled = true;
            
            setTimeout(() => {
                generatedAssets = {
                    bannerLogo: generateBannerLogo(),
                    headerLogo: generateHeaderLogo(),
                    favicon: generateFavicon(),
                    squareLogoLight: generateSquareLogo('light'),
                    squareLogoDark: generateSquareLogo('dark'),
                    signInBgLight: generateSignInBackground('light'),
                    script: generatePowerShellScript()
                };
                
                generateText.classList.remove('hidden');
                generateSpinner.classList.add('hidden');
                generateBtn.disabled = false;
                
                updatePreview();
                showResults();
            }, 1500);
        }
        
        function generatePowerShellScript() {
            return `# Microsoft Entra ID Branding Deployment Script
# Generated by: https://junior6995.github.io/entra-branding-tool/
# Free tool for Microsoft 365 administrators to customize tenant branding
# Compatible with: Azure AD, Entra ID, Office 365, Microsoft 365
# Requirements: Global Administrator role, Microsoft Graph PowerShell SDK
# Generated: ${new Date().toLocaleString()}
# Primary Color: ${primaryColorInput.value}
# Secondary Color: ${secondaryColorInput.value}

<#
.SYNOPSIS
    Deploys custom branding assets to Microsoft 365 tenant
.DESCRIPTION
    This script uploads organizational branding images to Microsoft Entra ID
    using Microsoft Graph PowerShell SDK. Supports both light and dark themes.
.NOTES
    Tool URL: https://junior6995.github.io/entra-branding-tool/
    Author: @junior6995
#>

Write-Host "Microsoft Entra ID Branding Deployment" -ForegroundColor Cyan
Write-Host "======================================" -ForegroundColor Cyan

# Check files
$requiredFiles = @(
    "BannerLogo.png",
    "HeaderLogo.png",
    "Favicon.png",
    "SquareLogoLight.png",
    "SquareLogoDark.png",
    "BackgroundLight.jpg"
)

$scriptPath = $PSScriptRoot
$missingFiles = @()

foreach ($file in $requiredFiles) {
    if (-not (Test-Path (Join-Path $scriptPath $file))) {
        $missingFiles += $file
    }
}

if ($missingFiles.Count -gt 0) {
    Write-Host "Missing files:" -ForegroundColor Red
    $missingFiles | ForEach-Object { Write-Host "  - $_" -ForegroundColor Red }
    exit 1
}

Write-Host "All files found!" -ForegroundColor Green

# Validate file sizes
Write-Host "Validating file sizes..." -ForegroundColor Yellow
$bannerSize = (Get-Item (Join-Path $scriptPath "BannerLogo.png")).Length / 1KB
$headerSize = (Get-Item (Join-Path $scriptPath "HeaderLogo.png")).Length / 1KB
$faviconSize = (Get-Item (Join-Path $scriptPath "Favicon.png")).Length / 1KB
$squareLightSize = (Get-Item (Join-Path $scriptPath "SquareLogoLight.png")).Length / 1KB
$squareDarkSize = (Get-Item (Join-Path $scriptPath "SquareLogoDark.png")).Length / 1KB

Write-Host "  BannerLogo.png: $([math]::Round($bannerSize, 2)) KB (limit: 50 KB)" -ForegroundColor $(if ($bannerSize -lt 50) { "Green" } else { "Red" })
Write-Host "  HeaderLogo.png: $([math]::Round($headerSize, 2)) KB (limit: 10 KB)" -ForegroundColor $(if ($headerSize -lt 10) { "Green" } else { "Red" })
Write-Host "  Favicon.png: $([math]::Round($faviconSize, 2)) KB (limit: 5 KB)" -ForegroundColor $(if ($faviconSize -lt 5) { "Green" } else { "Red" })
Write-Host "  SquareLogoLight.png: $([math]::Round($squareLightSize, 2)) KB (limit: 50 KB)" -ForegroundColor $(if ($squareLightSize -lt 50) { "Green" } else { "Red" })
Write-Host "  SquareLogoDark.png: $([math]::Round($squareDarkSize, 2)) KB (limit: 50 KB)" -ForegroundColor $(if ($squareDarkSize -lt 50) { "Green" } else { "Red" })

if ($bannerSize -gt 50 -or $headerSize -gt 10 -or $faviconSize -gt 5 -or $squareLightSize -gt 50 -or $squareDarkSize -gt 50) {
    Write-Host "ERROR: One or more files exceed their size limits!" -ForegroundColor Red
    Write-Host "Please regenerate the assets with a smaller logo or contact support." -ForegroundColor Yellow
    exit 1
}

# Import module
if (-not (Get-Module -ListAvailable -Name Microsoft.Graph)) {
    Write-Host "Installing Microsoft.Graph module..." -ForegroundColor Yellow
    Install-Module Microsoft.Graph -Scope CurrentUser -Force
}

Import-Module Microsoft.Graph.Identity.DirectoryManagement

# Connect
Write-Host "Connecting to Microsoft Graph..." -ForegroundColor Yellow
Connect-MgGraph -Scopes "Organization.ReadWrite.All", "Directory.ReadWrite.All"

# Get organization details for Microsoft 365/Office 365
$org = Get-MgOrganization
Write-Host "Organization: $($org.DisplayName)" -ForegroundColor Cyan
Write-Host "Tenant ID: $($org.Id)" -ForegroundColor Cyan

# Apply Azure AD/Entra ID branding
try {
    Write-Host "Configuring organizational branding..." -ForegroundColor Yellow
    
    # Check if default branding exists
    $defaultBranding = $null
    try {
        $defaultBranding = Get-MgOrganizationBrandingLocalization -OrganizationId $org.Id -OrganizationalBrandingLocalizationId "0" -ErrorAction Stop
    } catch {
        Write-Host "No default branding found, creating new..." -ForegroundColor Yellow
    }
    
    # Create or update default branding
    $brandingParams = @{
        BackgroundColor = "${primaryColorInput.value}"
        Id = "0"
    }
    
    if ($null -eq $defaultBranding) {
        # Create new branding localization
        New-MgOrganizationBrandingLocalization -OrganizationId $org.Id -BodyParameter $brandingParams
        Write-Host "Default branding created" -ForegroundColor Green
        Start-Sleep -Seconds 5
    } else {
        # Update existing
        Update-MgOrganizationBrandingLocalization -OrganizationId $org.Id -OrganizationalBrandingLocalizationId "0" -BackgroundColor "${primaryColorInput.value}"
        Write-Host "Background color updated" -ForegroundColor Green
    }
    
    # Upload images to default localization
    Write-Host "Uploading images..." -ForegroundColor Yellow
    
    # Banner Logo
    $bannerPath = Join-Path $scriptPath "BannerLogo.png"
    Set-MgOrganizationBrandingLocalizationBannerLogo -OrganizationId $org.Id -OrganizationalBrandingLocalizationId "0" -InFile $bannerPath
    Write-Host "  Banner logo uploaded" -ForegroundColor Green
    Start-Sleep -Seconds 2
    
    # Header Logo
    $headerPath = Join-Path $scriptPath "HeaderLogo.png"
    Set-MgOrganizationBrandingLocalizationHeaderLogo -OrganizationId $org.Id -OrganizationalBrandingLocalizationId "0" -InFile $headerPath
    Write-Host "  Header logo uploaded" -ForegroundColor Green
    Start-Sleep -Seconds 2
    
    # Favicon
    $faviconPath = Join-Path $scriptPath "Favicon.png"
    Set-MgOrganizationBrandingLocalizationFavicon -OrganizationId $org.Id -OrganizationalBrandingLocalizationId "0" -InFile $faviconPath
    Write-Host "  Favicon uploaded" -ForegroundColor Green
    Start-Sleep -Seconds 2
    
    # Square Logo Light
    $squarePath = Join-Path $scriptPath "SquareLogoLight.png"
    Set-MgOrganizationBrandingLocalizationSquareLogo -OrganizationId $org.Id -OrganizationalBrandingLocalizationId "0" -InFile $squarePath
    Write-Host "  Square logo (light) uploaded" -ForegroundColor Green
    Start-Sleep -Seconds 2
    
    # Background Image Light
    $bgPath = Join-Path $scriptPath "BackgroundLight.jpg"
    Set-MgOrganizationBrandingLocalizationBackgroundImage -OrganizationId $org.Id -OrganizationalBrandingLocalizationId "0" -InFile $bgPath
    Write-Host "  Background image (light) uploaded" -ForegroundColor Green
    
    # Try to create dark theme localization
    Write-Host "Configuring dark theme..." -ForegroundColor Yellow
    
    $darkBranding = $null
    try {
        $darkBranding = Get-MgOrganizationBrandingLocalization -OrganizationId $org.Id -OrganizationalBrandingLocalizationId "en-US" -ErrorAction Stop
    } catch {
        Write-Host "Creating dark theme configuration..." -ForegroundColor Yellow
    }
    
    if ($null -eq $darkBranding) {
        try {
            $darkParams = @{
                BackgroundColor = "${primaryColorInput.value}"
                Id = "en-US"
            }
            New-MgOrganizationBrandingLocalization -OrganizationId $org.Id -BodyParameter $darkParams
            Start-Sleep -Seconds 5
            
            # Upload dark theme specific assets
            # Only the square logo has a dark variant - all other assets are shared
            
            # Banner Logo (same as light theme)
            Set-MgOrganizationBrandingLocalizationBannerLogo -OrganizationId $org.Id -OrganizationalBrandingLocalizationId "en-US" -InFile $bannerPath
            Write-Host "  Dark theme banner logo uploaded (shared asset)" -ForegroundColor Green
            Start-Sleep -Seconds 2
            
            # Header Logo (same as light theme)
            Set-MgOrganizationBrandingLocalizationHeaderLogo -OrganizationId $org.Id -OrganizationalBrandingLocalizationId "en-US" -InFile $headerPath
            Write-Host "  Dark theme header logo uploaded (shared asset)" -ForegroundColor Green
            Start-Sleep -Seconds 2
            
            # Favicon (same as light theme)
            Set-MgOrganizationBrandingLocalizationFavicon -OrganizationId $org.Id -OrganizationalBrandingLocalizationId "en-US" -InFile $faviconPath
            Write-Host "  Dark theme favicon uploaded (shared asset)" -ForegroundColor Green
            Start-Sleep -Seconds 2
            
            # Square Logo Dark (ONLY dark-specific asset)
            $squareDarkPath = Join-Path $scriptPath "SquareLogoDark.png"
            Set-MgOrganizationBrandingLocalizationSquareLogo -OrganizationId $org.Id -OrganizationalBrandingLocalizationId "en-US" -InFile $squareDarkPath
            Write-Host "  Dark theme square logo uploaded (dark variant)" -ForegroundColor Green
            Start-Sleep -Seconds 2
            
            # Background (same as light theme - both use light background)
            Set-MgOrganizationBrandingLocalizationBackgroundImage -OrganizationId $org.Id -OrganizationalBrandingLocalizationId "en-US" -InFile $bgPath
            Write-Host "  Dark theme background uploaded (shared asset)" -ForegroundColor Green
        } catch {
            Write-Host "Note: Dark theme configuration may not be available" -ForegroundColor Yellow
        }
    } else {
        # Update existing dark theme branding
        Update-MgOrganizationBrandingLocalization -OrganizationId $org.Id -OrganizationalBrandingLocalizationId "en-US" -BackgroundColor "${primaryColorInput.value}"
        
        # Upload all assets (only square logo is different)
        Set-MgOrganizationBrandingLocalizationBannerLogo -OrganizationId $org.Id -OrganizationalBrandingLocalizationId "en-US" -InFile $bannerPath
        Write-Host "  Dark theme banner logo uploaded (shared asset)" -ForegroundColor Green
        Start-Sleep -Seconds 2
        
        Set-MgOrganizationBrandingLocalizationHeaderLogo -OrganizationId $org.Id -OrganizationalBrandingLocalizationId "en-US" -InFile $headerPath
        Write-Host "  Dark theme header logo uploaded (shared asset)" -ForegroundColor Green
        Start-Sleep -Seconds 2
        
        Set-MgOrganizationBrandingLocalizationFavicon -OrganizationId $org.Id -OrganizationalBrandingLocalizationId "en-US" -InFile $faviconPath
        Write-Host "  Dark theme favicon uploaded (shared asset)" -ForegroundColor Green
        Start-Sleep -Seconds 2
        
        $squareDarkPath = Join-Path $scriptPath "SquareLogoDark.png"
        Set-MgOrganizationBrandingLocalizationSquareLogo -OrganizationId $org.Id -OrganizationalBrandingLocalizationId "en-US" -InFile $squareDarkPath
        Write-Host "  Dark theme square logo uploaded (dark variant)" -ForegroundColor Green
        Start-Sleep -Seconds 2
        
        Set-MgOrganizationBrandingLocalizationBackgroundImage -OrganizationId $org.Id -OrganizationalBrandingLocalizationId "en-US" -InFile $bgPath
        Write-Host "  Dark theme background uploaded (shared asset)" -ForegroundColor Green
    }
    
    Write-Host ""
    Write-Host "Microsoft 365 tenant branding applied successfully!" -ForegroundColor Green
    Write-Host "Changes may take up to 24 hours to propagate across Azure AD." -ForegroundColor Yellow
    
} catch {
    Write-Host "Error deploying Microsoft 365 branding: $_" -ForegroundColor Red
    Write-Host "If you see 'Uri is invalid' errors, wait a few minutes for Azure AD to initialize the branding profile." -ForegroundColor Yellow
    Write-Host "Ensure you have Global Administrator rights in your Microsoft 365 tenant." -ForegroundColor Yellow
}

# Disconnect from Microsoft Graph
Disconnect-MgGraph
Write-Host "Disconnected from Microsoft 365 tenant" -ForegroundColor Green
Write-Host "Branding deployment complete!" -ForegroundColor Green`;
        }
        
        function updatePreview() {
            if (generatedAssets.signInBgLight) {
                const bgImage = generatedAssets.signInBgLight;
                
                previewArea.innerHTML = `
                    <div class="space-y-4">
                        <div>
                            <p class="text-sm text-gray-300 mb-2 font-semibold">Microsoft 365 Branding Assets Preview</p>
                            <div class="space-y-3">
                                <div>
                                    <p class="text-xs text-gray-400 mb-1">Banner Logo (280×60) - Office 365 email footers & app headers</p>
                                    <div class="rounded overflow-hidden shadow border border-gray-600 inline-block">
                                        <img src="${generatedAssets.bannerLogo}" width="280" height="60" alt="Microsoft 365 banner logo preview">
                                    </div>
                                </div>
                                <div>
                                    <p class="text-xs text-gray-400 mb-1">Header Logo (245×36) - Entra ID navigation headers</p>
                                    <div class="rounded overflow-hidden shadow border border-gray-600 inline-block">
                                        <img src="${generatedAssets.headerLogo}" width="245" height="36" alt="Azure AD header logo preview">
                                    </div>
                                </div>
                                <div class="grid grid-cols-3 gap-3">
                                    <div>
                                        <p class="text-xs text-gray-400 mb-1">Square Logo Light</p>
                                        <div class="rounded overflow-hidden shadow border border-gray-600 bg-gray-50 p-2">
                                            <img src="${generatedAssets.squareLogoLight}" width="120" height="120" alt="Microsoft 365 square logo light theme">
                                        </div>
                                    </div>
                                    <div>
                                        <p class="text-xs text-gray-400 mb-1">Square Logo Dark</p>
                                        <div class="rounded overflow-hidden shadow border border-gray-600 bg-gray-900 p-2">
                                            <img src="${generatedAssets.squareLogoDark}" width="120" height="120" alt="Microsoft 365 square logo dark theme">
                                        </div>
                                    </div>
                                    <div>
                                        <p class="text-xs text-gray-400 mb-1">Favicon (32×32)</p>
                                        <div class="rounded overflow-hidden shadow border border-gray-600 bg-white flex items-center justify-center" style="height: 124px;">
                                            <img src="${generatedAssets.favicon}" width="32" height="32" alt="Microsoft 365 tenant favicon">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div>
                            <p class="text-sm text-gray-300 mb-2 font-semibold">Microsoft 365 Sign-in Page Preview (${darkMode ? 'Dark' : 'Light'} Theme)</p>
                            <div class="relative rounded-lg overflow-hidden shadow-lg">
                                <img src="${bgImage}" class="w-full" style="height: 300px; object-fit: cover;" alt="Microsoft 365 sign-in page background preview">
                                <div class="absolute inset-0 flex items-center justify-center">
                                    <div class="bg-white bg-opacity-95 p-6 rounded-lg shadow-xl" style="width: 320px;">
                                        <img src="${darkMode ? generatedAssets.squareLogoDark : generatedAssets.squareLogoLight}" class="h-14 mb-3 mx-auto" alt="Company logo on sign-in page">
                                        <h2 class="text-lg font-semibold text-center mb-4 text-gray-900">Sign in</h2>
                                        <input type="text" placeholder="Email" class="w-full px-3 py-2 border rounded mb-3 text-sm" aria-label="Email input preview">
                                        <button style="background-color: ${primaryColorInput.value}" class="w-full px-3 py-2 text-white rounded text-sm">Next</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }
        }
        
        function showResults() {
            resultsSection.classList.remove('hidden');
            resultsSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
        
        // Download ZIP
        downloadBtn.addEventListener('click', () => {
            const zip = new JSZip();
            
            function dataURLtoBlob(dataURL) {
                const parts = dataURL.split(',');
                const mime = parts[0].match(/:(.*?);/)[1];
                const bstr = atob(parts[1]);
                let n = bstr.length;
                const u8arr = new Uint8Array(n);
                while(n--) {
                    u8arr[n] = bstr.charCodeAt(n);
                }
                return new Blob([u8arr], {type: mime});
            }
            
            // Add images
            zip.file('BannerLogo.png', dataURLtoBlob(generatedAssets.bannerLogo));
            zip.file('HeaderLogo.png', dataURLtoBlob(generatedAssets.headerLogo));
            zip.file('Favicon.png', dataURLtoBlob(generatedAssets.favicon));
            zip.file('SquareLogoLight.png', dataURLtoBlob(generatedAssets.squareLogoLight));
            zip.file('SquareLogoDark.png', dataURLtoBlob(generatedAssets.squareLogoDark));
            zip.file('BackgroundLight.jpg', dataURLtoBlob(generatedAssets.signInBgLight));
            
            // Add script only (no readme)
            zip.file('Deploy-M365Branding.ps1', generatedAssets.script);
            
            // Generate ZIP
            zip.generateAsync({type: 'blob'}).then(function(content) {
                saveAs(content, 'M365_Branding_Package.zip');
            });
        });
    </script>
</body>
</html>
