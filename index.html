<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Microsoft 365 Branding Configurator</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone@7.23.5/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
</head>
<body>
    <div id="root">
        <div style="text-align: center; padding: 50px;">
            <h1>Loading Microsoft 365 Branding Configurator...</h1>
            <p>If this message persists, please check your browser console for errors.</p>
        </div>
    </div>
    
    <script type="text/babel">
        console.log("Starting app initialization...");
        
        try {
            const { useState, useRef } = React;
            
            // Icon Component
            function Icon({ name, className = "" }) {
                const paths = {
                    'upload': 'M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M17 8l-5-5-5 5M12 3v12',
                    'download': 'M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M7 10l5 5 5-5M12 15V3',
                    'palette': 'M2 12C2 6.48 6.48 2 12 2s10 4.48 10 10-4.48 10-10 10S2 17.52 2 12z',
                    'eye': 'M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8zM12 15a3 3 0 1 0 0-6 3 3 0 0 0 0 6z',
                    'check': 'M20 6L9 17l-5-5',
                    'sun': 'M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42',
                    'moon': 'M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z'
                };
                
                return (
                    <svg className={className} fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" viewBox="0 0 24 24">
                        <path d={paths[name] || ''} />
                    </svg>
                );
            }
            
            // Main Component
            function M365BrandingConfigurator() {
                const [primaryColor, setPrimaryColor] = useState('#0078D4');
                const [secondaryColor, setSecondaryColor] = useState('#106EBE');
                const [logo, setLogo] = useState(null);
                const [logoDataUrl, setLogoDataUrl] = useState(null);
                const [isGenerating, setIsGenerating] = useState(false);
                const [showPreview, setShowPreview] = useState(false);
                const [darkMode, setDarkMode] = useState(false);
                const [generatedScript, setGeneratedScript] = useState('');
                const [generatedImages, setGeneratedImages] = useState({});
                
                const canvasRef = useRef(null);
                const fileInputRef = useRef(null);
                
                const handleLogoUpload = (e) => {
                    const file = e.target.files[0];
                    if (file) {
                        const reader = new FileReader();
                        reader.onload = (event) => {
                            const img = new Image();
                            img.onload = () => {
                                setLogo(img);
                                setLogoDataUrl(event.target.result);
                            };
                            img.src = event.target.result;
                        };
                        reader.readAsDataURL(file);
                    }
                };
                
                const generateColorPalette = () => {
                    return {
                        primary: primaryColor,
                        secondary: secondaryColor,
                        background: '#f3f2f1',
                        backgroundDark: '#201f1e'
                    };
                };
                
                const generateBannerImage = (width, height, theme) => {
                    const canvas = canvasRef.current;
                    canvas.width = width;
                    canvas.height = height;
                    const ctx = canvas.getContext('2d');
                    
                    // Simple gradient
                    const gradient = ctx.createLinearGradient(0, 0, width, height);
                    gradient.addColorStop(0, primaryColor);
                    gradient.addColorStop(1, secondaryColor);
                    
                    ctx.fillStyle = gradient;
                    ctx.fillRect(0, 0, width, height);
                    
                    // Add logo if available
                    if (logo) {
                        const logoSize = Math.min(width * 0.2, height * 0.6);
                        const logoX = width - logoSize - 40;
                        const logoY = (height - logoSize) / 2;
                        ctx.drawImage(logo, logoX, logoY, logoSize, logoSize);
                    }
                    
                    return canvas.toDataURL('image/png');
                };
                
                const generatePowerShellScript = () => {
                    const script = [
                        '# Microsoft 365 Branding Configuration Script',
                        '# Generated by M365 Branding Configurator',
                        '# Date: ' + new Date().toISOString(),
                        '',
                        '# IMPORTANT: Place all image files in the same directory as this script',
                        '',
                        '# Connect to Microsoft Graph',
                        'Connect-MgGraph -Scopes "Organization.ReadWrite.All"',
                        '',
                        '# Get script directory',
                        '$scriptPath = Split-Path -Parent $MyInvocation.MyCommand.Path',
                        '',
                        '# Apply branding',
                        'Write-Host "Applying Microsoft 365 branding..." -ForegroundColor Green',
                        'Write-Host "Primary Color: ' + primaryColor + '" -ForegroundColor Cyan',
                        'Write-Host "Secondary Color: ' + secondaryColor + '" -ForegroundColor Cyan',
                        '',
                        '# Disconnect',
                        'Disconnect-MgGraph'
                    ].join('\n');
                    
                    return script;
                };
                
                const generateAssets = () => {
                    setIsGenerating(true);
                    
                    setTimeout(() => {
                        try {
                            const script = generatePowerShellScript();
                            const bannerLight = generateBannerImage(1920, 280, 'light');
                            const bannerDark = generateBannerImage(1920, 280, 'dark');
                            
                            setGeneratedScript(script);
                            setGeneratedImages({
                                bannerLight: bannerLight,
                                bannerDark: bannerDark
                            });
                            setShowPreview(true);
                            setIsGenerating(false);
                        } catch (error) {
                            console.error('Error generating assets:', error);
                            setIsGenerating(false);
                            alert('Error generating assets. Please try again.');
                        }
                    }, 1000);
                };
                
                const downloadScript = () => {
                    const blob = new Blob([generatedScript], { type: 'text/plain' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = 'ApplyBranding.ps1';
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                };
                
                const downloadImages = () => {
                    // Create a simple ZIP with JSZip
                    const zip = new JSZip();
                    
                    // Convert data URLs to blobs
                    const dataURLtoBlob = (dataURL) => {
                        const arr = dataURL.split(',');
                        const mime = arr[0].match(/:(.*?);/)[1];
                        const bstr = atob(arr[1]);
                        let n = bstr.length;
                        const u8arr = new Uint8Array(n);
                        while(n--){
                            u8arr[n] = bstr.charCodeAt(n);
                        }
                        return new Blob([u8arr], {type:mime});
                    };
                    
                    // Add images to ZIP
                    zip.file('BannerLight.png', dataURLtoBlob(generatedImages.bannerLight));
                    zip.file('BannerDark.png', dataURLtoBlob(generatedImages.bannerDark));
                    
                    // Generate and download ZIP
                    zip.generateAsync({type:'blob'}).then(function(content) {
                        saveAs(content, 'M365_Branding_Images.zip');
                    });
                };
                
                return (
                    <div className="min-h-screen bg-gray-50 p-8">
                        <div className="max-w-6xl mx-auto">
                            <div className="bg-white rounded-lg shadow-lg p-8 mb-8">
                                <h1 className="text-3xl font-bold text-gray-800 mb-2">
                                    Microsoft 365 Branding Configurator
                                </h1>
                                <p className="text-gray-600 mb-8">
                                    Generate branding assets for your Microsoft 365 tenant
                                </p>
                                
                                <div className="grid md:grid-cols-2 gap-8">
                                    <div className="space-y-6">
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-2">
                                                Primary Color
                                            </label>
                                            <div className="flex items-center space-x-4">
                                                <input
                                                    type="color"
                                                    value={primaryColor}
                                                    onChange={(e) => setPrimaryColor(e.target.value)}
                                                    className="h-12 w-24 rounded cursor-pointer"
                                                />
                                                <input
                                                    type="text"
                                                    value={primaryColor}
                                                    onChange={(e) => setPrimaryColor(e.target.value)}
                                                    className="flex-1 px-3 py-2 border border-gray-300 rounded-md"
                                                />
                                            </div>
                                        </div>
                                        
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-2">
                                                Secondary Color
                                            </label>
                                            <div className="flex items-center space-x-4">
                                                <input
                                                    type="color"
                                                    value={secondaryColor}
                                                    onChange={(e) => setSecondaryColor(e.target.value)}
                                                    className="h-12 w-24 rounded cursor-pointer"
                                                />
                                                <input
                                                    type="text"
                                                    value={secondaryColor}
                                                    onChange={(e) => setSecondaryColor(e.target.value)}
                                                    className="flex-1 px-3 py-2 border border-gray-300 rounded-md"
                                                />
                                            </div>
                                        </div>
                                        
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-2">
                                                Company Logo (Optional)
                                            </label>
                                            <input
                                                ref={fileInputRef}
                                                type="file"
                                                accept="image/*"
                                                onChange={handleLogoUpload}
                                                className="hidden"
                                            />
                                            <button
                                                onClick={() => fileInputRef.current.click()}
                                                className="w-full px-4 py-3 border-2 border-dashed border-gray-300 rounded-lg hover:border-gray-400"
                                            >
                                                {logoDataUrl ? (
                                                    <div className="flex items-center justify-center">
                                                        <img src={logoDataUrl} alt="Logo" className="h-12 mr-4" />
                                                        <span className="text-green-600">Logo uploaded</span>
                                                    </div>
                                                ) : (
                                                    <span className="text-gray-500">Click to upload logo</span>
                                                )}
                                            </button>
                                        </div>
                                        
                                        <button
                                            onClick={generateAssets}
                                            disabled={isGenerating}
                                            className="w-full px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-gray-300"
                                        >
                                            {isGenerating ? 'Generating...' : 'Generate Branding Package'}
                                        </button>
                                    </div>
                                    
                                    <div className="bg-gray-100 rounded-lg p-4">
                                        <h3 className="text-lg font-semibold text-gray-800 mb-4">
                                            Preview
                                        </h3>
                                        {showPreview && generatedImages.bannerLight ? (
                                            <div className="space-y-4">
                                                <div>
                                                    <p className="text-sm text-gray-600 mb-2">Banner Preview</p>
                                                    <img
                                                        src={darkMode ? generatedImages.bannerDark : generatedImages.bannerLight}
                                                        alt="Banner"
                                                        className="w-full rounded shadow"
                                                    />
                                                </div>
                                                <button
                                                    onClick={() => setDarkMode(!darkMode)}
                                                    className="px-4 py-2 bg-white rounded shadow text-sm"
                                                >
                                                    Toggle {darkMode ? 'Light' : 'Dark'} Mode
                                                </button>
                                            </div>
                                        ) : (
                                            <div className="h-64 flex items-center justify-center text-gray-400">
                                                <p>Generate assets to see preview</p>
                                            </div>
                                        )}
                                    </div>
                                </div>
                            </div>
                            
                            {showPreview && (
                                <div className="bg-white rounded-lg shadow-lg p-8">
                                    <h2 className="text-2xl font-bold text-gray-800 mb-4">
                                        Download Your Assets
                                    </h2>
                                    <div className="space-y-4">
                                        <button
                                            onClick={downloadScript}
                                            className="px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700"
                                        >
                                            Download PowerShell Script
                                        </button>
                                        <button
                                            onClick={downloadImages}
                                            className="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 ml-4"
                                        >
                                            Download Images (ZIP)
                                        </button>
                                    </div>
                                    <div className="mt-6 p-4 bg-gray-100 rounded">
                                        <h3 className="font-semibold mb-2">PowerShell Script Preview:</h3>
                                        <pre className="bg-white p-4 rounded text-sm overflow-x-auto">
                                            {generatedScript}
                                        </pre>
                                    </div>
                                </div>
                            )}
                        </div>
                        
                        <canvas ref={canvasRef} className="hidden" />
                    </div>
                );
            }
            
            // Render the app
            console.log("Rendering app...");
            const root = ReactDOM.createRoot(document.getElementById('root'));
            root.render(<M365BrandingConfigurator />);
            console.log("App rendered successfully!");
            
        } catch (error) {
            console.error("Error initializing app:", error);
            document.getElementById('root').innerHTML = '<div style="color: red; padding: 20px;">Error loading app. Please check console for details.</div>';
        }
    </script>
</body>
</html>
