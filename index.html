<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Microsoft 365 Branding Configurator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <style>
        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3498db;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            display: inline-block;
            margin-right: 8px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .icon {
            display: inline-block;
            width: 1em;
            height: 1em;
            stroke: currentColor;
            fill: none;
            stroke-width: 2;
            stroke-linecap: round;
            stroke-linejoin: round;
            vertical-align: middle;
        }
    </style>
</head>
<body>
    <div id="app" class="min-h-screen bg-gray-50 p-8">
        <div class="max-w-6xl mx-auto">
            <!-- Header -->
            <div class="bg-white rounded-lg shadow-lg p-8 mb-8">
                <h1 class="text-3xl font-bold text-gray-800 mb-2">Microsoft 365 Branding Configurator</h1>
                <p class="text-gray-600">Generate complete branding assets for your Microsoft 365 tenant with just a logo and colors.</p>
            </div>

            <!-- Main Content -->
            <div class="grid md:grid-cols-2 gap-8">
                <!-- Configuration Panel -->
                <div class="bg-white rounded-lg shadow-lg p-6">
                    <h2 class="text-xl font-semibold mb-6">Configuration</h2>
                    
                    <!-- Primary Color -->
                    <div class="mb-6">
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            Primary Color
                        </label>
                        <div class="flex items-center space-x-4">
                            <input type="color" id="primaryColor" value="#0078D4" class="h-12 w-24 rounded cursor-pointer">
                            <input type="text" id="primaryColorText" value="#0078D4" class="flex-1 px-3 py-2 border border-gray-300 rounded-md">
                        </div>
                    </div>
                    
                    <!-- Secondary Color -->
                    <div class="mb-6">
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            Secondary Color
                        </label>
                        <div class="flex items-center space-x-4">
                            <input type="color" id="secondaryColor" value="#106EBE" class="h-12 w-24 rounded cursor-pointer">
                            <input type="text" id="secondaryColorText" value="#106EBE" class="flex-1 px-3 py-2 border border-gray-300 rounded-md">
                        </div>
                    </div>
                    
                    <!-- Logo Upload -->
                    <div class="mb-6">
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            Company Logo (PNG)
                        </label>
                        <input type="file" id="logoInput" accept="image/png" class="hidden">
                        <button id="uploadBtn" class="w-full px-4 py-3 border-2 border-dashed border-gray-300 rounded-lg hover:border-gray-400 transition-colors">
                            <span id="uploadText" class="text-gray-500">Click to upload logo</span>
                            <div id="logoPreview" class="hidden flex items-center justify-center">
                                <img id="logoImg" class="h-16 mr-4">
                                <span class="text-green-600">Logo uploaded</span>
                            </div>
                        </button>
                    </div>
                    
                    <!-- Generate Button -->
                    <button id="generateBtn" disabled class="w-full px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors">
                        <span id="generateText">Generate Branding Package</span>
                        <div id="generateSpinner" class="hidden">
                            <div class="spinner"></div>
                            Generating Assets...
                        </div>
                    </button>
                </div>
                
                <!-- Preview Panel -->
                <div class="bg-white rounded-lg shadow-lg p-6">
                    <div class="flex items-center justify-between mb-4">
                        <h2 class="text-xl font-semibold">Live Preview</h2>
                        <button id="darkModeBtn" class="p-2 rounded-lg bg-gray-100 hover:bg-gray-200">
                            <span id="darkModeIcon">ðŸŒ™</span>
                        </button>
                    </div>
                    
                    <div id="previewArea" class="bg-gray-100 rounded-lg p-4 min-h-[400px] flex items-center justify-center">
                        <p class="text-gray-400">Upload a logo and generate assets to see preview</p>
                    </div>
                </div>
            </div>
            
            <!-- Results Section -->
            <div id="resultsSection" class="hidden mt-8 space-y-6">
                <!-- Instructions -->
                <div class="bg-white rounded-lg shadow-lg p-8">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">Deployment Instructions</h2>
                    <ol class="space-y-3 text-sm">
                        <li><strong>1.</strong> Download the image package using the button below</li>
                        <li><strong>2.</strong> Copy the PowerShell script and save as ApplyBranding.ps1</li>
                        <li><strong>3.</strong> Place script in same folder as images</li>
                        <li><strong>4.</strong> Run PowerShell as Administrator</li>
                        <li><strong>5.</strong> Execute: <code class="bg-gray-100 px-2 py-1 rounded">.\ApplyBranding.ps1</code></li>
                    </ol>
                </div>
                
                <!-- PowerShell Script -->
                <div class="bg-white rounded-lg shadow-lg p-8">
                    <div class="flex items-center justify-between mb-4">
                        <h2 class="text-2xl font-bold text-gray-800">PowerShell Script</h2>
                        <button id="copyBtn" class="px-4 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors">
                            Copy Script
                        </button>
                    </div>
                    <pre id="scriptContent" class="bg-gray-900 text-gray-100 p-4 rounded-lg overflow-x-auto text-sm"></pre>
                </div>
                
                <!-- Download Button -->
                <div class="bg-white rounded-lg shadow-lg p-8">
                    <button id="downloadBtn" class="px-8 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors">
                        Download Image Package (ZIP)
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Hidden Canvas -->
    <canvas id="canvas" style="display: none;"></canvas>
    
    <script>
        // Global variables
        let logo = null;
        let logoDataUrl = null;
        let darkMode = false;
        let generatedAssets = {};
        
        // Get elements
        const primaryColorInput = document.getElementById('primaryColor');
        const primaryColorText = document.getElementById('primaryColorText');
        const secondaryColorInput = document.getElementById('secondaryColor');
        const secondaryColorText = document.getElementById('secondaryColorText');
        const logoInput = document.getElementById('logoInput');
        const uploadBtn = document.getElementById('uploadBtn');
        const uploadText = document.getElementById('uploadText');
        const logoPreview = document.getElementById('logoPreview');
        const logoImg = document.getElementById('logoImg');
        const generateBtn = document.getElementById('generateBtn');
        const generateText = document.getElementById('generateText');
        const generateSpinner = document.getElementById('generateSpinner');
        const darkModeBtn = document.getElementById('darkModeBtn');
        const darkModeIcon = document.getElementById('darkModeIcon');
        const previewArea = document.getElementById('previewArea');
        const resultsSection = document.getElementById('resultsSection');
        const scriptContent = document.getElementById('scriptContent');
        const copyBtn = document.getElementById('copyBtn');
        const downloadBtn = document.getElementById('downloadBtn');
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        
        // Color sync
        primaryColorInput.addEventListener('change', (e) => {
            primaryColorText.value = e.target.value;
        });
        primaryColorText.addEventListener('change', (e) => {
            primaryColorInput.value = e.target.value;
        });
        secondaryColorInput.addEventListener('change', (e) => {
            secondaryColorText.value = e.target.value;
        });
        secondaryColorText.addEventListener('change', (e) => {
            secondaryColorInput.value = e.target.value;
        });
        
        // Logo upload
        uploadBtn.addEventListener('click', () => {
            logoInput.click();
        });
        
        logoInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (event) => {
                    const img = new Image();
                    img.onload = () => {
                        logo = img;
                        logoDataUrl = event.target.result;
                        logoImg.src = logoDataUrl;
                        uploadText.classList.add('hidden');
                        logoPreview.classList.remove('hidden');
                        generateBtn.disabled = false;
                    };
                    img.src = event.target.result;
                };
                reader.readAsDataURL(file);
            }
        });
        
        // Dark mode toggle
        darkModeBtn.addEventListener('click', () => {
            darkMode = !darkMode;
            darkModeIcon.textContent = darkMode ? 'â˜€ï¸' : 'ðŸŒ™';
            updatePreview();
        });
        
        // Generate assets
        generateBtn.addEventListener('click', generateAssets);
        
        function generateBanner(width, height, theme) {
            canvas.width = width;
            canvas.height = height;
            
            // Create gradient
            const gradient = ctx.createLinearGradient(0, 0, width, height);
            if (theme === 'light') {
                gradient.addColorStop(0, primaryColorInput.value);
                gradient.addColorStop(1, secondaryColorInput.value);
            } else {
                gradient.addColorStop(0, adjustBrightness(primaryColorInput.value, -30));
                gradient.addColorStop(1, adjustBrightness(secondaryColorInput.value, -30));
            }
            
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, width, height);
            
            // Add logo
            if (logo) {
                const logoSize = Math.min(width * 0.2, height * 0.6);
                const logoX = width - logoSize - 40;
                const logoY = (height - logoSize) / 2;
                ctx.globalAlpha = 0.9;
                ctx.drawImage(logo, logoX, logoY, logoSize, logoSize);
                ctx.globalAlpha = 1;
            }
            
            return canvas.toDataURL('image/png');
        }
        
        function generateBackground(width, height, theme) {
            canvas.width = width;
            canvas.height = height;
            
            // Create radial gradient
            const centerX = width / 2;
            const centerY = height / 2;
            const radius = Math.max(width, height);
            
            const gradient = ctx.createRadialGradient(centerX, centerY, 0, centerX, centerY, radius);
            if (theme === 'light') {
                gradient.addColorStop(0, '#f3f2f1');
                gradient.addColorStop(1, primaryColorInput.value + '20');
            } else {
                gradient.addColorStop(0, '#201f1e');
                gradient.addColorStop(1, primaryColorInput.value + '40');
            }
            
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, width, height);
            
            return canvas.toDataURL('image/png');
        }
        
        function generateFavicon(size) {
            canvas.width = size;
            canvas.height = size;
            
            if (logo) {
                ctx.fillStyle = '#ffffff';
                ctx.fillRect(0, 0, size, size);
                ctx.drawImage(logo, 0, 0, size, size);
            } else {
                ctx.fillStyle = primaryColorInput.value;
                ctx.fillRect(0, 0, size, size);
                ctx.fillStyle = '#ffffff';
                ctx.font = 'bold ' + (size * 0.6) + 'px Arial';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText('M', size / 2, size / 2);
            }
            
            return canvas.toDataURL('image/png');
        }
        
        function adjustBrightness(hex, amount) {
            const num = parseInt(hex.replace('#', ''), 16);
            const r = Math.max(0, Math.min(255, (num >> 16) + amount));
            const g = Math.max(0, Math.min(255, ((num >> 8) & 0x00FF) + amount));
            const b = Math.max(0, Math.min(255, (num & 0x0000FF) + amount));
            return '#' + ((r << 16) | (g << 8) | b).toString(16).padStart(6, '0');
        }
        
        function generateAssets() {
            generateText.classList.add('hidden');
            generateSpinner.classList.remove('hidden');
            generateBtn.disabled = true;
            
            setTimeout(() => {
                generatedAssets = {
                    bannerLight: generateBanner(1920, 280, 'light'),
                    bannerDark: generateBanner(1920, 280, 'dark'),
                    bgDesktopLight: generateBackground(1920, 1080, 'light'),
                    bgDesktopDark: generateBackground(1920, 1080, 'dark'),
                    bgMobileLight: generateBackground(768, 1024, 'light'),
                    bgMobileDark: generateBackground(768, 1024, 'dark'),
                    favicon16: generateFavicon(16),
                    favicon32: generateFavicon(32),
                    squareLogo: logoDataUrl,
                    script: generatePowerShellScript()
                };
                
                generateText.classList.remove('hidden');
                generateSpinner.classList.add('hidden');
                generateBtn.disabled = false;
                
                updatePreview();
                showResults();
            }, 1000);
        }
        
        function generatePowerShellScript() {
            return `# Microsoft 365 Branding Configuration Script
# Generated on: ${new Date().toISOString()}
# Primary Color: ${primaryColorInput.value}
# Secondary Color: ${secondaryColorInput.value}

# Get script directory
$scriptPath = Split-Path -Parent $MyInvocation.MyCommand.Path

# Connect to Microsoft Graph
Connect-MgGraph -Scopes "Organization.ReadWrite.All"

# Verify files exist
$files = @("BannerImageLight.png", "BannerImageDark.png", "BackgroundImageDesktopLight.png", 
          "BackgroundImageDesktopDark.png", "BackgroundImageMobileLight.png", 
          "BackgroundImageMobileDark.png", "SquareLogo.png", "Favicon16.png", "Favicon32.png")

foreach ($file in $files) {
    if (-not (Test-Path (Join-Path $scriptPath $file))) {
        Write-Host "Missing file: $file" -ForegroundColor Red
        exit 1
    }
}

Write-Host "Applying branding..." -ForegroundColor Green
Write-Host "Primary Color: ${primaryColorInput.value}" -ForegroundColor Cyan
Write-Host "Secondary Color: ${secondaryColorInput.value}" -ForegroundColor Cyan

# Apply branding configuration here
# [Implementation details would go here]

Disconnect-MgGraph
Write-Host "Branding applied successfully!" -ForegroundColor Green`;
        }
        
        function updatePreview() {
            if (generatedAssets.bannerLight) {
                const bgImage = darkMode ? generatedAssets.bgDesktopDark : generatedAssets.bgDesktopLight;
                const bannerImage = darkMode ? generatedAssets.bannerDark : generatedAssets.bannerLight;
                
                previewArea.innerHTML = `
                    <div class="space-y-4">
                        <div>
                            <p class="text-sm text-gray-600 mb-2">Banner Preview</p>
                            <img src="${bannerImage}" class="w-full rounded shadow">
                        </div>
                        <div>
                            <p class="text-sm text-gray-600 mb-2">Sign-in Page Preview</p>
                            <div class="relative">
                                <img src="${bgImage}" class="w-full rounded shadow" style="max-height: 300px; object-fit: cover;">
                                <div class="absolute inset-0 flex items-center justify-center">
                                    <div class="bg-white bg-opacity-95 p-6 rounded-lg shadow-xl max-w-xs">
                                        <img src="${logoDataUrl}" class="h-12 mb-3 mx-auto">
                                        <h2 class="text-lg font-semibold text-center mb-3">Sign in</h2>
                                        <input type="text" placeholder="Email" class="w-full px-3 py-2 border rounded mb-2">
                                        <button style="background-color: ${primaryColorInput.value}" class="w-full px-4 py-2 text-white rounded">Next</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }
        }
        
        function showResults() {
            resultsSection.classList.remove('hidden');
            scriptContent.textContent = generatedAssets.script;
        }
        
        // Copy script
        copyBtn.addEventListener('click', () => {
            navigator.clipboard.writeText(generatedAssets.script).then(() => {
                copyBtn.textContent = 'Copied!';
                setTimeout(() => {
                    copyBtn.textContent = 'Copy Script';
                }, 2000);
            }).catch(() => {
                // Fallback
                const textarea = document.createElement('textarea');
                textarea.value = generatedAssets.script;
                document.body.appendChild(textarea);
                textarea.select();
                document.execCommand('copy');
                document.body.removeChild(textarea);
                copyBtn.textContent = 'Copied!';
                setTimeout(() => {
                    copyBtn.textContent = 'Copy Script';
                }, 2000);
            });
        });
        
        // Download ZIP
        downloadBtn.addEventListener('click', () => {
            const zip = new JSZip();
            
            // Convert data URL to blob
            function dataURLtoBlob(dataURL) {
                const parts = dataURL.split(',');
                const mime = parts[0].match(/:(.*?);/)[1];
                const bstr = atob(parts[1]);
                let n = bstr.length;
                const u8arr = new Uint8Array(n);
                while(n--) {
                    u8arr[n] = bstr.charCodeAt(n);
                }
                return new Blob([u8arr], {type: mime});
            }
            
            // Add files to ZIP
            zip.file('BannerImageLight.png', dataURLtoBlob(generatedAssets.bannerLight));
            zip.file('BannerImageDark.png', dataURLtoBlob(generatedAssets.bannerDark));
            zip.file('BackgroundImageDesktopLight.png', dataURLtoBlob(generatedAssets.bgDesktopLight));
            zip.file('BackgroundImageDesktopDark.png', dataURLtoBlob(generatedAssets.bgDesktopDark));
            zip.file('BackgroundImageMobileLight.png', dataURLtoBlob(generatedAssets.bgMobileLight));
            zip.file('BackgroundImageMobileDark.png', dataURLtoBlob(generatedAssets.bgMobileDark));
            zip.file('Favicon16.png', dataURLtoBlob(generatedAssets.favicon16));
            zip.file('Favicon32.png', dataURLtoBlob(generatedAssets.favicon32));
            zip.file('SquareLogo.png', dataURLtoBlob(generatedAssets.squareLogo));
            
            // Generate ZIP
            zip.generateAsync({type: 'blob'}).then(function(content) {
                saveAs(content, 'M365_Branding_Images.zip');
            });
        });
    </script>
</body>
</html>
